---
title: "proyecto_final"
output: html_document
date: "2025-11-05"
---

Cargar las librerías y la base de datos y limpiarla
```{r}
library(dplyr)
library(ggplot2)
library(modeest)
library(stringr)

tabla <- read.csv("bd1_8.csv", sep=";", header= TRUE)
head(tabla)

# Limpiamos la tabla de datos
tabla <- tabla %>%
  mutate(across(where(is.character), ~trimws(.)))
tabla$id <- 1:nrow(tabla)
```

Seleccionar sólo Bejaia de la base de datos así como si hubo incendio o no
```{r}
# Filtramos por Bejaia
Bejaia <- tabla %>% 
  filter(Region == "Bejaia")

#Filtramos por Bejaia y si hay o no incendio
Bejaia_fire <- Bejaia %>%
  filter(Classes == "fire")
Bejaia_not_fire <- Bejaia %>% 
  filter(Classes == "not fire")

# Filtramos por Sidi
Sidi <- tabla %>% 
  filter(Region == "Sidi-Bel_Abbes")

#Filtramos por Bejaia y si hay o no incendio
Sidi_fire <- Sidi %>%
  filter(Classes == "fire")
Sidi_not_fire <- Sidi %>% 
  filter(Classes == "not fire")

#Cuando hay o no fuego
not_fire <- tabla %>% 
  filter(Classes == "not fire")
fire <- tabla %>% 
  filter(Classes == "fire")
```

Vemos como quedan los incendios en cada zona
```{r}
ggplot(tabla, aes(Region, fill=Classes))+
  geom_bar()
```
Tras el gráfico, vemos que en Bejaia los días con fuego y sin fuego son casi los mismos. En cambio, en Sidi-Bel_Abbes, vemos claramente que han habido más días con incendios que sin. 

Hacemos las tablas de frecuencias
```{r}
Bejaia_frecuencias <- Bejaia %>% 
  group_by(Classes) %>% 
  summarise(ni = n()) %>% 
  mutate(fi = round(ni/sum(ni), 4)) %>% 
  mutate(fi_porc = round(fi*100, 2));Bejaia_frecuencias

Sidi_frecuencias <- Sidi %>% 
  group_by(Classes) %>% 
  summarise(ni = n()) %>% 
  mutate(fi = round(ni/sum(ni), 4)) %>% 
  mutate(fi_porc = round(fi*100, 2));Sidi_frecuencias
```
Tras hacer las frecuencias, vemos que en Bejaia hay igualdad en días de incendios, mientras que en Sidi, casi el doble de días con fuego que sin fuego.

A continuación vamos a determinar qué factores contribuyen a los incendios. Puesto que hay dos regiones distintas, los factores que contribuyen a incendios varían de una zona a otra.

### EFRÉN
#1 En primer lugar empezaremos analizando la zona de Bejaia. En concreto la lluvia
```{r}
lluvia_media_Bf <- Bejaia_fire %>% 
  summarize(máximo = max(Rain),
            mínimo = min(Rain),
            media = mean(Rain),
            var = mean((Rain - media)^2),
            sd = sqrt(var)
            );lluvia_media_Bf

lluvia_media_Bnf <- Bejaia_not_fire%>% 
  summarize(máximo = max(Rain),
            mínimo = min(Rain),
            media = mean(Rain),
            mediana = median(Rain),
            DM_me= mean(abs(Rain - mediana)),
            var = mean((Rain - media)^2),
            sd = sqrt(var),
            CV = sd/media,
            DV = mean(abs(Rain-mediana))
            );lluvia_media_Bnf
ggplot(tabla, aes(x=Region, y=Rain, color=Classes))+
  geom_boxplot()
```
En el gráfico observamos que los días que hubieron incendios, no ha habido lluvia. En cambio, los días en los que no han habido incendios, sí ha llovido algo. Esto tiene sentido ya que si llueve, es más dificil que se produzca un incendio.
Vemos además en que la media de lluvia de los días con fuego es de casi 0 (0.01) y los días en los que no hubieron incendios, la mediana es de 0.5.



#2 El siguiente dato que vamos a analizar es el RH (Humedad relativa, en %)
```{r}
ggplot(tabla, aes(x=Region, y=RH, color=Classes))+
  geom_boxplot()
ggplot(tabla, aes(x=Region, y=RH, color=Classes))+
  geom_point(alpha=0.3)
```
En bejaia la humedad relativa no da mucha información, los datos no están claramente separados según si hay o no incendios. En el caso de Sidi, vemos que entre 20% y casi 50% de RH, hay fuego
```{r}
min_RH_sidinf <- min(Sidi_not_fire$RH);min_RH_sidinf
```
Vemos que entre un 20% y un 42%, podemos determinar que hay incendios en Sidi



#3 Ahora vamos a ver como afecta DMC a los incendios
```{r}
ggplot(tabla, aes(x=Region, y=DMC, color=Classes))+
  geom_boxplot()
```
En el gráfico vemos que cuando no hay incendios, los valores de DMC son más bajos que cuando hay incendios. En este caso, son parecidos las dos regiones, cuando hay incendios, los valores pueden estar entre 16 y casi 65, mientras que cuando no hay incendios, suelen estar por debajo de 15. DMC se ve afectado por la temperatura, humaedad relativa y lluvia.
```{r}
ggplot(tabla, aes(Rain, DMC, color=Classes))+
  geom_point()
ggplot(tabla, aes(x = id)) +
  geom_line(aes(y = Rain), color = "blue") +
  geom_line(aes(y = DMC), color = "red")
cor(Bejaia$DMC,Bejaia$Rain)
```
Vemos en el gráfico de líneas que la Lluvia afecta directamente a DMC, cuando no llueve el mantillo está menos humedo y cuando llueve está más húmedo. A menor valor de DMC, mayor será la humedad. 
En el gráfico de puntos vemos que esto es correcto, a mayor lluvia menor humedad en el mantillo y viceversa.


### MARTÍN
#4 vamos a continuar analizando los incendios pero ahora centrados en la temperatura
```{r}
temperatura_media_Bf <- Bejaia_fire %>% 
  summarize(máximo = max(Temperature),
            mínimo = min(Temperature),
            media = mean(Temperature),
            var = mean((Temperature - media)^2),
            sd = sqrt(var)
            );temperatura_media_Bf
temperatura_media_Bnf <- Bejaia_not_fire%>% 
  summarize(máximo = max(Temperature),
            mínimo = min(Temperature),
            media = mean(Temperature),
            mediana = median(Temperature),
            DM_me= mean(abs(Temperature - mediana)),
            var = mean((Temperature - media)^2),
            sd = sqrt(var),
            CV = sd/media,
            DV = mean(abs(Temperature-mediana))
            );temperatura_media_Bnf
temperatura_media_Sf <- Sidi_fire %>% 
  summarize(máximo = max(Temperature),
            mínimo = min(Temperature),
            media = mean(Temperature),
            var = mean((Temperature - media)^2),
            sd = sqrt(var)
            );temperatura_media_Sf
temperatura_media_Snf <- Sidi_not_fire%>% 
  summarize(máximo = max(Temperature),
            mínimo = min(Temperature),
            media = mean(Temperature),
            mediana = median(Temperature),
            DM_me= mean(abs(Temperature - mediana)),
            var = mean((Temperature - media)^2),
            sd = sqrt(var),
            CV = sd/media,
            DV = mean(abs(Temperature-mediana))
            );temperatura_media_Snf

ggplot(tabla, aes(x=Region, y=Temperature, color=Classes))+
  geom_boxplot()
```

Tras el analisis de las temperaturas en Bejaia cuando han habido incendios y no, podemos concluir, que las altas temperaturas contibuyen a la aparicion de incendios, ya que como se observa en el gráfico cuando las temperaturas son altas hay incendios, pero no son un factor muy determinante. 

Sin embargo también podemos notar que cuanto mas bajas son las temperaturas menos incendios hay, aunque esto no implica que no hayan habido incendios cuando hay bajas temperaturas.

Tas el analisis de los incendios con respecto a la temperatura en Sidi-Bel_Abbes podemos observar claras diferencias con Bejaia, en primer lugar las temperaturas en esta zona son mucho mas elevadas (tanto cuando ha habido incendios como no), además que al contrario que en Bejaia aquí las altas temperaturas por lo general si suelen conllevar siempre a la aparicion de incendios y las bajas temperaturas a la ausencia de estos tal como se observa en el gráfico.

#5 Ahora por lo que respecta al índice meteorológico de incendios FWI tenemos:
```{r}
FWI_media_Bf <- Bejaia_fire%>% 
  summarize(máximo = max(FWI),
            mínimo = min(FWI),
            media = mean(FWI),
            mediana = median(FWI),
            DM_me= mean(abs(FWI - mediana)),
            var = mean((FWI - media)^2),
            sd = sqrt(var),
            CV = sd/media,
            DV = mean(abs(FWI-mediana))
            );FWI_media_Bf
FWI_media_Bnf <- Bejaia_not_fire%>% 
  summarize(máximo = max(FWI),
            mínimo = min(FWI),
            media = mean(FWI),
            mediana = median(FWI),
            DM_me= mean(abs(FWI - mediana)),
            var = mean((FWI - media)^2),
            sd = sqrt(var),
            CV = sd/media,
            DV = mean(abs(FWI-mediana))
            );FWI_media_Bnf
ggplot(tabla, aes(Region, FWI, color= Classes))+
  geom_boxplot()
```
Observando los resultados de los analisis de Bejaia y Sidi-Bel_Abbes podemos decir:
Por un lado, tanto en Bejaia como en Sidi se puede observar una gran disparidad en los datos de cuando hubo incendios y no con respecto a el FWI, lo cual significa que a menor indice meteorológico de incendios menos incendios hay y viceversa.
Podemos concluir entonces que el FWI esta directamente relacionado con los incendios ya que con la ausencia de este los incendios son inexistentes.

### ALI



#6 Vamos a continuar analizando los incendios pero ahora centrados en el FFMC y el CD

#VARIABLE 1: FFMC (Fine Fuel Moisture Code)

# Gráfico 1: Boxplot FFMC vs Incendios
```{r}
ggplot(tabla, aes(x = Region, y = FFMC, fill = Classes)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "FFMC vs Ocurrencia de Incendios",
       subtitle = "Fine Fuel Moisture Code - Humedad de combustibles finos",
       x = "Tipo", 
       y = "FFMC") +
  theme_minimal()

```
Tras ver el gráfico, podemos determinar que en ambas regiones, a partir del valor 80 de FFMC, se producen incendios, y por debajo no hay incendios.

 El boxplot muestra la distribución de FFMC en cada categoría
 La caja representa el 50% central de los datos, las líneas los extremos

# Estadísticas por tipo de incendio
```{r}
ffmc_stats <- tabla %>%
  group_by(Classes) %>%
  summarise(
    Media = (mean(FFMC)),
    Mediana = (median(FFMC)),
    Minimo = (min(FFMC)),
    Maximo = (max(FFMC)),
    Desviacion = mean(abs(FFMC-Mediana))
  )
ffmc_stats
```

Los resultados muestran una clara diferencia en los valores de FFMC entre días con y sin incendios.
 Los días con incendios ("fire") presentan valores  más altos de FFMC (media de 84.2 y 65.1), lo que confirma que la baja humedad en combustibles finos es un factor determinante para la ocurrencia de incendios forestales.
La mediana de 87.2 en días con incendios indica que más del 50% de estos eventos
 ocurren cuando el FFMC supera este valor, mientras que en días sin incendios
 la mediana es de apenas 66.5.


# Gráfico 2: Densidad de FFMC
```{r}
ggplot(tabla, aes(x = Region, y = FFMC, fill = Classes)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "FFMC por Región y Tipo de Incendio",
       x = "Región", 
       y = "FFMC") +
  theme_minimal()
```


En ambas regiones, los incendios ocurren con FFMC >80, mientras que sin incendios FFMC <70.
Sidi-Bel_Abbes muestra valores más altos (FFMC ~85-90 con incendios) vs Bejaia (FFMC ~80-85).
El umbral de riesgo se mantiene consistente: FFMC ≥80 indica alto riesgo de incendio.
FFMC por región
```{r}
ffmc_region <- tabla %>%
  filter(complete.cases(FFMC, Region, Classes)) %>%
  group_by(Region, Classes) %>%
  summarise(FFMC_Promedio = round(mean(FFMC), 1), .groups = 'drop')
cat("FFMC promedio por región y tipo de incendio:\n")
print(ffmc_region)

```
Confirmado: en ambas regiones, FFMC >80 con incendios y <70 sin incendios.
 Sidi-Bel_Abbes: 86.3 con incendios vs 66.1 sin incendios 
 Bejaia: 82.4 con incendios vs 64.2 sin incendios 
 Sidi-Bel_Abbes muestra mayor riesgo potencial con valores más altos.

# VARIABLE 2: DC (Drought Code)  

# Gráfico 3: Boxplot DC vs Incendios
```{r}
ggplot(tabla, aes(x = Region, y = DC, fill = Classes)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "DC vs Ocurrencia de Incendios",
       subtitle = "Drought Code - Severidad de la sequía",
       x = "Tipo de día", 
       y = "DC") +
  theme_minimal()
```
Los puntos negros representan valores atípicos (outliers) - datos que se encuentran por fuera del rango normal de distribución.
 En días SIN incendios ("not fire"): varios puntos arriba indican días con DC
 En días CON incendios ("fire"): puntos abajo muestran incendios que ocurrieron


# Gráfico 4: Densidad de DC
```{r}
ggplot(tabla, aes(x = Region, y = DC, fill = Classes)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "DC por Región y Tipo de Incendio",
       x = "Región", 
       y = "DC (Severidad de sequía)") +
  theme_minimal()

```
 En ambas regiones, los incendios ocurren con DC más alto: ~80-150 y ~10-80 sin incendios.
Sidi-Bel_Abbes muestra valores más extremos (DC hasta 200 con incendios) vs Bejaia (máx ~180).



# Estadísticas por tipo de incendio
```{r}
dc_stats <- datos %>%
  group_by(Classes) %>%
  summarise(
    Media = (mean(DC)),
    Mediana = (median(DC)),
    Minimo = (min(DC)),
    Maximo = (max(DC)),
    Desviacion = mean(abs(DC-Mediana))
  )
dc_stats
```
 como podemos ver :
 -CON incendios: DC promedio = 94.3 (sequía severa)
 -SIN incendios: DC promedio = 28.9 (sequía moderada)
 Umbral claro: DC >50 indica alto riesgo de incendio

# DC por región
```{r}
dc_region <- tabla %>%
  filter(complete.cases(DC, Region, Classes)) %>%
  group_by(Region, Classes) %>%
  summarise(DC_Promedio = round(mean(DC), 1), .groups = 'drop')
print(dc_region)

```
podemos decir que Ambas regiones siguen el mismo patrón: DC >90 con incendios y <30 sin incendios de modo que :
Sidi-Bel_Abbes: 98.3 con incendios (más severo) vs 29.3 sin incendios
 Bejaia: 90.8 con incendios y 28.6 sin incendios
entonces DC >50 = alto riesgo en ambas zonas.



# RELACIÓN ENTRE FFMC Y DC


```{r}
cat("\n=== RELACIÓN ENTRE FFMC Y DC ===\n")
correlacion <- cor(tabla$FFMC, datos$DC, use = "complete.obs")
cat("Correlación entre FFMC y DC:", round(correlacion, 3), "\n")

```

Valor = 0.507 → Correlación positiva  Esto significa que cuando FFMC aumenta, DC también tiende a aumentar,
entonces no es correlación perfecta (1.0), otros factores también influyen.


(para los miembros del grupo: La función cat() sirve para imprimir texto y resultados en la consola de R.
 Es como un "print" pero más flexible para combinar texto y variables.


# Gráfico 5: Scatter plot FFMC vs DC
```{r}
ggplot(tabla, aes(x = FFMC, y = DC, color = Classes)) + 
  geom_boxplot() +
  labs(title = "Relación entre FFMC y DC",
       subtitle = paste("Correlación =", round(correlacion, 3)),
       x = "FFMC (Humedad combustibles)", 
       y = "DC (Severidad sequía)") +
  theme_minimal() 
```
Se ve claramente la correlación positiva (0.631): cuando FFMC aumenta, DC también.
 Los puntos naranjas (incendios) se concentran en la esquina superior derecha:
FFMC >80 y DC >50 = zona de alto riesgo.
Los puntos azules (sin incendios) están en la zona inferior izquierda.

# UMBRALES CRÍTICOS


```{r}
cat("\n=== UMBRALES CRÍTICOS SUGERIDOS ===\n")

dias_incendios <- tabla %>% filter(Classes == "fire")

umbral_ffmc <- quantile(dias_incendios$FFMC, 0.25)
umbral_dc <- quantile(dias_incendios$DC, 0.25)

cat("Umbral FFMC para riesgo de incendio:", round(umbral_ffmc, 1), "\n")
cat("Umbral DC para riesgo de incendio:", round(umbral_dc, 1), "\n")

```

- FFMC: 75% de los incendios ocurrieron con valores SUPERIORES a 80.5
- DC: 75% de los incendios ocurrieron con valores SUPERIORES a 43.6
hemos utilizado el percentile 25 porque :
 Es un criterio PREVENTIVO: si FFMC > 80.5 o DC > 43.6, hay ALTO RIESGO
 porque el 75% de incendios históricos ocurrieron en estas condiciones.





(para los miembros del grupo:Este código calcula umbrales de riesgo CONSERVADORES usando el percentil 25)



###ÓSCAR



La siguiente variable que vamos a analizar es la acumulación de combustible (BUI) en ambas zonas, con tal de ver si esto afecta directamente a la aparición de incendios.


```{r}
Bui_media_bf <- Bejaia_fire %>% 
  summarise(maximo= max(BUI),
            minimo= min(BUI),
            media= mean(BUI),
            mediana= median(BUI),
            Dm_me = mean(abs(BUI-  mediana)),
            var= mean((BUI- media)^2),
            sd= sqrt(var),
            CV= sd/media,
            DV= mean(abs(BUI- mediana)),
            );Bui_media_bf

Bui_media_bnf <- Bejaia_not_fire %>% 
  summarise(maximo= max(BUI),
            minimo= min(BUI),
            media= mean(BUI),
            mediana= median(BUI),
            Dm_me = mean(abs(BUI-  mediana)),
            var= mean((BUI- media)^2),
            sd= sqrt(var),
            CV= sd/media,
            DV= mean(abs(BUI- mediana)),
            );Bui_media_bnf

ggplot(tabla, aes(x= Region, y= BUI, color= Classes))+
  geom_boxplot()+
  labs(title= "%BUI")

ggplot(tabla, aes(x=Region, y= BUI, color=Classes))+
  geom_point(alpha=0.5)+
  labs(title = "%BUI")

```


Como podemos ver en ambos gráficos, observamos que entre un (0-10)% de BUI no suele haber incendios, esto tiene sentido ya que a menor cantidad de material inflamable menor es la posibilidad de generar un incendio.
Además, En ambas regiones, la media de BUI es bastante superior a los dias sin fuego por lo que evidentemente el riesgo de incendio aumenta a mayor acumuulación de combustible.  Por ejemplo, la media de Bejaia en dias de fuego es de 24,5 y los dias sin incendios 6.8.

Por otra parte la varianza alta en los dias de fuego (+200) indica que el BUI suele variar y no hay un valor que se repita constantemente, pero siendo habitual que supere el 15%. En cambio, los dias sin incendios hay una varianza mas baja(40), lo que nos dice que el BUI se mantiene bajo (entre el 0-10%).




Ahora vamos a añadir las variables ISI(índice de propagación inicial) y Ws(velocidad del viento) para comparar las dos al mismo tiempo en un gráfico.


Primero vamos con ISI, con los datos de Sidi-Bel_Abbes:

```{r}
Isi_media_sf <- Sidi_fire %>% 
  summarise(maximo= max(ISI),
            minimo= min(ISI),
            media= mean(ISI),
            mediana= median(ISI),
            Dm_me = mean(abs(ISI-  mediana)),
            var= mean((ISI- media)^2),
            sd= sqrt(var),
            CV= sd/media,
            DV= mean(abs(ISI- mediana)),
            );Isi_media_sf

Isi_media_snf <- Sidi_not_fire %>% 
  summarise(maximo= max(ISI),
            minimo= min(ISI),
            media= mean(ISI),
            mediana= median(ISI),
            Dm_me = mean(abs(ISI-  mediana)),
            var= mean((ISI- media)^2),
            sd= sqrt(var),
            CV= sd/media,
            DV= mean(abs(ISI- mediana)),
            );Isi_media_snf
```




Ahora hacemos lo mismo pero para la velocidad del viento:

```{r}
Ws_media_sf <- Sidi_fire %>% 
  summarise(maximo= max(Ws),
            minimo= min(Ws),
            media= mean(Ws),
            mediana= median(Ws),
            Dm_me = mean(abs(Ws-  mediana)),
            var= mean((Ws- media)^2),
            sd= sqrt(var),
            CV= sd/media,
            DV= mean(abs(Ws- mediana)),
            );Ws_media_sf

Ws_media_snf <- Sidi_not_fire %>% 
  summarise(maximo= max(Ws),
            minimo= min(Ws),
            media= mean(Ws),
            mediana= median(Ws),
            Dm_me = mean(abs(Ws-  mediana)),
            var= mean((Ws- media)^2),
            sd= sqrt(var),
            CV= sd/media,
            DV= mean(abs(Ws- mediana)),
            );Ws_media_snf
```




Una vez tenemos los datos de ambas variables, las comparamos en un mismo gráfico para ver si tienen alguna correlación directa:



```{r}
ggplot(tabla, aes(x= id))+
  geom_line(aes(y= ISI), color= "red")+
  geom_line(aes(y= Ws), color= "blue")+
  labs(title= "ISI(rojo) y Ws(Azul) en ambas zonas")+
  theme_minimal()
cor(Sidi$ISI, Sidi$Ws)
cor(Bejaia$ISI, Bejaia$Ws)
```

Tras analizar el gráfico y tener un valor cor(correlación) muy bajo (0.12) en Sidi-Bel_Abbes y -0.03 en Bejaia, podemos concluir que aunque el viento pueda incrementar ligeramente el valor de ISI, no es un factor determinante para decir que a mayor velocidad de viento, mayor índice de propagación, Aunque pueda parecer lógico la relación no se da porque seguramente cuando en estas regiones hay viento es cuando más humedad haya y por tanto no se produzcan indencios, igualmente esto son solo suposiciones que más adelante comprobamos si son ciertas.

Además,esto indica que probablemente otras variables como la humedad de la región o la acumulación de combustible sean más determinantes. Para ello vamos a comparar el viento con el BUI.





```{r}
ggplot(tabla, aes(x= id))+
  geom_line(aes(y= ISI), color= "red")+
  geom_line(aes(y= BUI), color= "green")+
  labs(title= "ISI(rojo) y BUI(Verde) en ambas zonas")+
  theme_minimal()
cor(Sidi$ISI, Sidi$BUI)
cor(Bejaia$ISI, Bejaia$BUI)
```

Aquí si podemos ver que hay una correlación muy alta en Sidi(>0.6) e incluso aún más en Bejaia(>0.7), lo que significa que cuando hay una mayor cantidad de combustible, el fuego se propaga más rápidamente y nos indica que la cantidad de BUI es un factor determinante para  la propagación del fuego.




